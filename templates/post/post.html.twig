{% extends 'base.html.twig' %}

{% block title %}{{ post.title }} - Reddit{% endblock %}

{% block body %}
    <div>
        <h1>{{ post.title }}</h1>
        <p>by {{ post.author.username }} in <a href="{{ path('subreddit_show', {'id': post.subreddit.id}) }}">r/{{ post.subreddit.name }}</a></p>
        <p>{{ post.content|raw }}</p>

        {% if app.user and (post.author == app.user or is_granted('ROLE_ADMIN')) %}
            <a href="{{ path('post_edit', {'id': post.id}) }}" class="btn btn-secondary btn-sm">Edit</a>
            <form method="post" action="{{ path('post_delete', {'id': post.id}) }}" style="display:inline" onsubmit="return confirm('Etes-vous sÃ»re?');">
                <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ post.id) }}">
                <button class="btn btn-danger btn-sm">Delete</button>
            </form>
        {% endif %}
    </div>

    <hr>

    <h3>Commentez</h3>

    {% for comment in post.comments %}
        <div class="mb-3 border rounded p-2">
            <p><strong>{{ comment.author.username }}</strong> said:</p>
            <p>{{ comment.content|raw }}</p>
            {% if comment.fileName %}
                <p>Attachment: <a href="{{ asset('uploads/comments/' ~ comment.fileName) }}" target="_blank">View File</a></p>
            {% endif %}
            <small>Ecrit il y a {{ comment.createdAt|date('Y-m-d H:i') }}</small>

            {% if app.user and (comment.author == app.user or is_granted('ROLE_ADMIN')) %}
                <form method="post" action="{{ path('comment_delete', {'id': comment.id}) }}" onsubmit="return confirm('Delete this comment?');">
                    <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ comment.id) }}">
                    <button class="btn btn-danger btn-sm mt-2">Delete</button>
                </form>
            {% endif %}
        </div>
    {% else %}
        <p>Aucun commentaire.</p>
    {% endfor %}

    {% if app.user and app.user.isConfirmed %}
        <hr>
        <h4>Ajouter un Commentaire</h4>
        {{ form_start(commentForm, {'attr': {'enctype':'multipart/form-data'}}) }}
        {{ form_row(commentForm.content) }}
        {{ form_row(commentForm.file) }}
        <button type="submit" class="btn btn-primary">Submit Comment</button>
        {{ form_end(commentForm) }}
    {% else %}
        <p><em>You need to confirm your account to post comments.</em></p>
    {% endif %}
{% endblock %}
